import time
from pymetasploit3.msfrpc import MsfRpcClient

client = MsfRpcClient(password='password', port=55552,ssl=False)

'''
['add_perm_token', 'auth', 'authenticated', 'call', 'consoles', 'core', 'db',
 'encoding', 'headers', 'host', 'jobs', 'login', 'logout', 'modules', 'plugins',
  'port', 'post_request', 'sessions', 'ssl', 'token', 'uri']
'''
print(len(client.modules.exploits))


exploit=client.modules.use('auxiliary','scanner/portscan/syn')

'''
print(exploit.description)

print(exploit.options)

print(exploit.missing_required)
'''
exploit["RHOSTS"]="ctftime.org"
exploit["PORTS"]="22-80"
#job_id=exploit.execute()['job_id']

#time.sleep(5)
#print(client.jobs.info(job_id))


cid = client.consoles.console().cid

print(cid)
'''
client.consoles.console(cid).write('search portscan')
client.consoles.console(cid).write('use 6')
client.consoles.console(cid).write('set RHOSTS ctftime.org')
client.consoles.console(cid).write('set PORTS 22,80')
client.consoles.console(cid).write('run')
while True:
	get=client.consoles.console(cid).read()
	if get['busy']==False:
		break
print(get)
'''
print(client.consoles.console(cid).run_module_with_output(exploit, payload='cmd/unix/interact'))